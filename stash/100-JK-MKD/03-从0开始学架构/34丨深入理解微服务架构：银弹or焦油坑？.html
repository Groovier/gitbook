<!DOCTYPE html><html><head>
    <meta charset="utf-8"><meta name="keywords" content="极客时间,IT,职业教育,知识付费,二叉树,极客Live,极客搜索,互联网,前端开发,后端开发,编程语言,人工智能,区块链,技术大会,技术管理,产品,研发,测试,运维,数据库,架构,微服务,实战,技术专家,Java,iOS,Android,Linux,Go" id="metakeywords"><meta name="description" content="极客时间是一款由极客邦科技倾力打造的面向IT领域的知识服务产品,旨在帮助用户提升技术认知.板块包含专栏文章、视频课程、新闻、资讯、直播、图书、商城等。内容覆盖IT从业者的全生命周期知识技能图谱,邀请左耳朵耗子、王争、杨晓峰、winter,丁奇等顶级技术和行业专家为你讲述技术本质,解读科技动态." id="metadesc"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover"><meta name="format-detection" content="telephone=no"><title>极客时间 | 从0开始学架构</title><style data-savepage-href="https://static001.geekbang.org/static/time/css/app.e30427d82748c1a9d53a048cf510f63c.css">html{color:#333;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-rendering:optimizelegibility;font-family:Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif}html.borderbox *,html.borderbox :after,html.borderbox :before{box-sizing:border-box}article,aside,blockquote,body,button,code,dd,details,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hr,input,legend,li,menu,nav,ol,p,pre,section,td,textarea,th,ul{margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}audio,canvas,video{display:inline-block}body,button,input,select,textarea{font:300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}blockquote{position:relative;color:#999;font-weight:400;border-left:1px solid #1abc9c;padding-left:1em;margin:1em 3em 1em 2em}@media only screen and (max-width:640px){blockquote{margin:1em 0}}abbr,acronym{border-bottom:1px dotted;font-variant:normal}abbr{cursor:help}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:400}ol,ul{list-style:none}caption,th{text-align:left}q:after,q:before{content:""}sub,sup{font-size:75%;line-height:0;position:relative}:root sub,:root sup{vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a{color:#1abc9c}a:hover{text-decoration:underline}.typo a{border-bottom:1px solid #1abc9c}.typo a:hover{border-bottom-color:#555;color:#555}.typo a:hover,a,ins{text-decoration:none}.typo-u,u{text-decoration:underline}mark{background:#fffdd1;border-bottom:1px solid #ffedce;padding:2px;margin:0 5px}code,pre,pre tt{font-family:Courier,Courier New,monospace}pre{background:hsla(0,0%,97%,.7);border:1px solid #ddd;padding:1em 1.5em;display:block;-webkit-overflow-scrolling:touch}hr{border:none;border-bottom:1px solid #cfcfcf;margin-bottom:.8em;height:10px}.typo-small,figcaption,small{font-size:.9em;color:#888}b,strong{font-weight:700;color:#000}[draggable]{cursor:move}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.textwrap,.textwrap td,.textwrap th{word-wrap:break-word;word-break:break-all}.textwrap-table{table-layout:fixed}.serif{font-family:Palatino,Optima,Georgia,serif}.typo-dl,.typo-form,.typo-hr,.typo-ol,.typo-p,.typo-pre,.typo-table,.typo-ul,.typo dl,.typo form,.typo hr,.typo ol,.typo p,.typo pre,.typo table,.typo ul,blockquote{margin-bottom:1rem}h1,h2,h3,h4,h5,h6{font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;line-height:1.35}.typo-h1,.typo-h2,.typo-h3,.typo-h4,.typo-h5,.typo-h6,.typo h1,.typo h2,.typo h3,.typo h4,.typo h5,.typo h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}.typo-h1,.typo h1{font-size:2em}.typo-h2,.typo h2{font-size:1.8em}.typo-h3,.typo h3{font-size:1.6em}.typo-h4,.typo h4{font-size:1.4em}.typo-h5,.typo-h6,.typo h5,.typo h6{font-size:1.2em}.typo-ul,.typo ul{margin-left:1.3em;list-style:disc}.typo-ol,.typo ol{list-style:decimal;margin-left:1.9em}.typo-ol ol,.typo-ol ul,.typo-ul ol,.typo-ul ul,.typo li ol,.typo li ul{margin-bottom:.8em;margin-left:2em}.typo-ol ul,.typo-ul ul,.typo li ul{list-style:circle}.typo-table td,.typo-table th,.typo table caption,.typo table td,.typo table th{border:1px solid #ddd;padding:.5em 1em;color:#666}.typo-table th,.typo table th{background:#fbfbfb}.typo-table thead th,.typo table thead th{background:hsla(0,0%,95%,.7)}.typo table caption{border-bottom:none}.typo-input,.typo-textarea{-webkit-appearance:none;border-radius:0}.typo-em,.typo em,caption,legend{color:#000;font-weight:inherit}.typo-em{position:relative}.typo-em:after{position:absolute;top:.65em;left:0;width:100%;overflow:hidden;white-space:nowrap;content:"\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"}.typo img{max-width:100%}.common-content{font-weight:400;color:#353535;line-height:1.75rem;white-space:normal;word-break:normal;font-size:1rem}.common-content img{display:block;max-width:100%;background-color:#eee}.common-content audio,.common-content video{width:100%;background-color:#eee}.common-content center,.common-content font{margin-top:1rem;display:inline-block}.common-content center{width:100%}.common-content pre{margin-top:1rem;padding-left:0;padding-right:0;position:relative;overflow:hidden}.common-content pre code{font-size:.8rem;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;display:block;width:100%;box-sizing:border-box;padding-left:1rem;padding-right:1rem;overflow-x:auto}.common-content hr{border:none;margin-top:1.5rem;margin-bottom:1.5rem;border-top:1px solid #f5f5f5;height:1px;background:none}.common-content b,.common-content h1,.common-content h2,.common-content h3,.common-content h4,.common-content h5,.common-content strong{font-weight:700}.common-content h1,.common-content h2{font-size:1.125rem;margin-bottom:.45rem}.common-content h3,.common-content h4,.common-content h5{font-size:1rem;margin-bottom:.45rem}.common-content p{font-weight:400;color:#353535;margin-top:.15rem}.common-content .orange{color:#ff5a05}.common-content .reference{font-size:1rem;color:#888}.custom-rich-content h1{margin-top:0;font-weight:400;font-size:15.25px;border-bottom:1px solid #eee;line-height:2.8}.custom-rich-content li,.custom-rich-content p{font-size:14px;color:#888;line-height:1.6}table.hljs-ln{margin-bottom:0;border-spacing:0;border-collapse:collapse}table.hljs-ln,table.hljs-ln tbody,table.hljs-ln td,table.hljs-ln tr{box-sizing:border-box}table.hljs-ln td{padding:0;border:0}table.hljs-ln td.hljs-ln-numbers{min-width:15px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;cursor:pointer;user-select:none}table.hljs-ln td.hljs-ln-code,table.hljs-ln td.hljs-ln-numbers{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;line-height:20px;vertical-align:top}table.hljs-ln td.hljs-ln-code{position:relative;padding-right:10px;padding-left:10px;overflow:visible;color:#24292e;word-wrap:normal;white-space:pre}video::-webkit-media-controls{overflow:hidden!important}video::-webkit-media-controls-enclosure{width:calc(100% + 32px);margin-left:auto}.button-cancel{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel,.button-primary{-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary{color:#fff;background-color:#fa8919;border-radius:3px}.gkui-message-content-wrap .gkui-message-close .defaultClose:after,.gkui-message-content-wrap .gkui-message-close .defaultClose:before{transition:all .3s ease}.gkui-message-content-wrap{position:relative;text-align:center}.gkui-message-content-wrap .gkui-message-content{display:inline-block;overflow:hidden;padding:10px 16px;margin-bottom:6px;background:#fff;font-size:14px;line-height:14px;border-radius:3px;box-shadow:0 1px 6px rgba(0,0,0,.2);pointer-events:all}.gkui-message-content-wrap .gkui-message-loading-prefix{display:inline-block;margin-right:4px;transform:translateY(2px)}.gkui-message-content-wrap .gkui-message-close{display:inline-block;margin-left:4px;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.gkui-message-content-wrap .gkui-message-close .defaultClose{display:inline-block;position:relative;width:10px;height:10px}.gkui-message-content-wrap .gkui-message-close .defaultClose:after,.gkui-message-content-wrap .gkui-message-close .defaultClose:before{position:absolute;top:5px;right:0;display:block;content:"";width:12px;height:1px;background:#8a8a8a}.gkui-message-content-wrap .gkui-message-close .defaultClose:before{transform:rotate(45deg)}.gkui-message-content-wrap .gkui-message-close .defaultClose:after{transform:rotate(-45deg)}.gkui-message-content-wrap .gkui-message-close .defaultClose:hover:after,.gkui-message-content-wrap .gkui-message-close .defaultClose:hover:before{background:#333}.fade-up-enter-active,.fade-up-leave-active{transition:all .4s ease}.fade-up-enter,.fade-up-leave-to{opacity:0;transform:translateY(-50%)}.fade-up-leave-to{height:0}.gkui-message-content-wrap .gkui-message-info{border:1px solid #ddd}.gkui-message-content-wrap .gkui-message-success{border:1px solid #666;background:#666;color:#fff}.gkui-message-content-wrap .gkui-message-error{border:1px solid rgba(0,0,0,.7);background-color:rgba(0,0,0,.7);color:#fff}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}html{background:#fff;min-height:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{width:100%}body.fixed{overflow:hidden;position:fixed;width:100vw;height:100vh}i{font-style:normal}a{word-wrap:break-word;-webkit-tap-highlight-color:rgba(0,0,0,0)}a:hover{text-decoration:none}.fade-enter-active,.fade-leave-active{transition:opacity .3s}.MathJax,.MathJax_CHTML,.MathJax_MathContainer,.MathJax_MathML,.MathJax_PHTML,.MathJax_PlainSource,.MathJax_SVG{outline:0}.ios-app-switch .js-audit{display:none}.gkui--modal-block-scroll{position:absolute;overflow:hidden;width:100vw}#gkui-modal-controller{width:100%}#gkui-modal-controller,.gkui-modal-layer{position:fixed;left:0;top:0;z-index:90000}.gkui-modal-layer{right:0;bottom:0;background-color:rgba(55,55,55,.3)}.fade-enter-active,.fade-leave-active{transition:all .3s ease}.fade-enter,.fade-leave-to{opacity:0}.gkui-message-list[data-v-99cd8b4a]{position:fixed;top:0;left:0;width:100%;pointer-events:none}._2sRsF5RP_0{position:relative}._loading_wrap_{position:fixed;width:100vw;height:100vh;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999}._loading_div_class_,._loading_wrap_{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}._loading_div_class_{word-wrap:break-word;padding:.5rem .75rem;text-align:center;z-index:9999;font-size:.6rem;max-width:60%;color:#fff;border-radius:.25rem;-ms-flex-direction:column;flex-direction:column}._loading_div_class_ .message{color:#353535;font-size:16px;line-height:3}.spinner{animation:circle-rotator 1.4s linear infinite}.spinner *{line-height:0;box-sizing:border-box}@keyframes circle-rotator{0%{transform:rotate(0deg)}to{transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;transform-origin:center;animation:circle-dash 1.4s ease-in-out infinite,circle-colors 5.6s ease-in-out infinite}@keyframes circle-colors{0%{stroke:#fa8919}to{stroke:#fa8919}}@keyframes circle-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;transform:rotate(135deg)}to{stroke-dashoffset:187;transform:rotate(450deg)}}.confirm-box-wrapper,.confirm-box-wrapper .mask{position:absolute;top:0;left:0;right:0;bottom:0}.confirm-box-wrapper .mask{background:rgba(0,0,0,.6)}.confirm-box-wrapper .confirm-box{position:fixed;top:50%;left:50%;width:267px;background:#fff;transform:translate(-50%,-50%);border-radius:7px}.confirm-box-wrapper .confirm-box .head{margin:0 18px;font-size:18px;text-align:center;line-height:65px;border-bottom:1px solid #d9d9d9}.confirm-box-wrapper .confirm-box .body{padding:18px;padding-bottom:0;color:#353535;font-size:12.5px;max-height:150px;overflow:auto}.confirm-box-wrapper .confirm-box .foot{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:18px}.confirm-box-wrapper .confirm-box .foot .button-cancel{border:1px solid #d9d9d9}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><style type="text/css">.hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}</style><style type="text/css">._3ADRghFH_0{background:#000}._21xvFvr7_0{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}._3O_7qs2p_0{opacity:0}._2q1SuvsS_0{opacity:1}._20-cXID6_0{max-width:46.25rem;min-height:100vh;margin:0 auto;background:#fff;-webkit-transition:background-color .3s ease;transition:background-color .3s ease}._20-cXID6_0 .PYIrCCrf_0{color:#888}._20-cXID6_0 ._1EUVUUrC_0,._20-cXID6_0 .PYIrCCrf_0{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}._20-cXID6_0 ._1EUVUUrC_0{color:#fff;background-color:#fa8919;font-weight:500}._20-cXID6_0 ._2QmGFWqF_0{padding-left:22px;padding-right:15px}._20-cXID6_0 ._3lTiSebX_0{color:#fa8919;font-size:15px;font-weight:600;line-height:24px;border-radius:5px;padding:12px;background-color:#f6f7fb;margin-top:20px}._20-cXID6_0 ._3lTiSebX_0 ._7OuU9_xM_0{font-size:12px}._20-cXID6_0 ._50pDbNcP_0{padding-top:22px;padding-bottom:82px}._20-cXID6_0 .vJXgmLTi_0{color:#353535;font-weight:700;line-height:30px;font-size:22px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}._20-cXID6_0 ._2LbT9q3y_0{color:#888;font-size:13px;font-weight:400;margin-top:4px;margin-bottom:12px}._20-cXID6_0 ._2LbT9q3y_0 ._3FoXPaWx_0{margin-top:10px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center;overflow:hidden}._20-cXID6_0 ._2LbT9q3y_0 ._3FoXPaWx_0 .YLYfWxsg_0{color:#404040;font-size:15px;font-weight:400;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}._20-cXID6_0 ._2LbT9q3y_0 ._3FoXPaWx_0 .nJKayDbe_0{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-left:10px;height:23px;border-radius:23px;font-size:13px;font-weight:400;color:#fa8919;padding-left:10px;padding-right:6px;background:#fbf5ee;white-space:nowrap}._20-cXID6_0 ._2LbT9q3y_0 ._3FoXPaWx_0 .nJKayDbe_0 ._2k8p2GLU_0{margin-left:2px;font-size:12px;-webkit-transform:scale(.7);transform:scale(.7)}._20-cXID6_0 ._3Jbcj4Iu_0._3BZBHEhm_0 video-webkit-media-controls-fullscreen-button{display:none}._20-cXID6_0 ._1-ZfmNK8_0{border-radius:6px;vertical-align:top;margin-bottom:24px;width:100%}._20-cXID6_0 ._3IatBmhv_0{margin-top:0}._20-cXID6_0 ._22WJb59B_0{color:#b2b2b2;padding-bottom:20px;font-size:13px;font-weight:400}._20-cXID6_0 ._22WJb59B_0 ._3ODTLCec_0{font-size:15px}._20-cXID6_0 ._3c2GGLul_0{width:100%;margin:20px 0}._20-cXID6_0 ._3EKy7lL9_0{overflow:hidden;padding-top:10px;margin-bottom:-30px}._20-cXID6_0 ._3EKy7lL9_0 a._1EUVUUrC_0{float:right;height:20px;font-size:12px;line-height:20px;padding:4px 8px;cursor:pointer}._20-cXID6_0 ._1qhD3bdE_0{padding-top:32px;border-top:10px solid #f6f7fb;-webkit-transition:border-top .3s ease;transition:border-top .3s ease;position:relative}._20-cXID6_0 ._1qhD3bdE_0 h2{color:#404040;position:relative;z-index:1;margin-bottom:1rem;font-weight:700;font-size:19px}._20-cXID6_0 ._1qhD3bdE_0 ._2FC_cD1O_0{font-size:16px;margin-left:5px}._20-cXID6_0 ._2-nZIZjB_0{position:absolute;z-index:2;background:#fa8919;font-size:13px;color:#fff;text-align:center;height:28px;width:80px;line-height:28px;-webkit-box-shadow:4px 5px 20px 1px rgba(250,137,25,.24);box-shadow:4px 5px 20px 1px rgba(250,137,25,.24);border-radius:28px;right:22px;top:32px}._20-cXID6_0 .YGjSYR8B_0{z-index:10;cursor:pointer}._20-cXID6_0 ._2DmyW7ex_0{cursor:pointer;padding-top:24px;padding-bottom:24px;position:relative}._20-cXID6_0 ._2DmyW7ex_0:before{content:" ";height:.5px;background:#e8e8e8;position:absolute;top:0;left:0;-webkit-box-sizing:border-box;box-sizing:border-box;left:22px;right:22px}._20-cXID6_0 ._2DmyW7ex_0 ._1M5b-cvc_0{height:38px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}._20-cXID6_0 ._2DmyW7ex_0 ._1M5b-cvc_0 ._3l55W_ak_0{-webkit-box-flex:0;-ms-flex:0 0 62px;flex:0 0 62px;text-align:center;color:#888;font-size:14px;border-radius:10px;height:22px;line-height:22px;background:#f6f7fb;font-weight:400}._20-cXID6_0 ._2DmyW7ex_0 ._1M5b-cvc_0 ._3Ov-zF0e_0{margin-left:10px;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;color:#888;font-size:15px;height:22px;line-height:22px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:400}.ZphmEful_0{height:60px;background:transparent}._2zq_fmRg_0{font-size:15px;color:#888;line-height:24px;border-left:3px solid #e8e8e8;padding-left:15px}._3uTMOfKI_0,._24nFYvU9_0{-webkit-transition:all .3s ease;transition:all .3s ease}._3WwMT2EY_0 ._1uEolA82_0,._9b3gTd1B_0 ._2NnvkXgw_0{-webkit-transform:translateX(-508px);transform:translateX(-508px)}._3WwMT2EY_0 ._2NnvkXgw_0,._9b3gTd1B_0 ._1uEolA82_0{-webkit-transform:translateX(508px);transform:translateX(508px)}._3BZBHEhm_0 ._2LbT9q3y_0{font-weight:700}._3BZBHEhm_0 ._2DmyW7ex_0:before{height:1px}@media only screen and (max-width:769px){._15u7cU5H_0{display:none!important}}@media only screen and (min-width:740px){._3ADRghFH_0{background:#fff}}.g78dTtKm_0{background:#f6f0e0}.g78dTtKm_0 ._1qhD3bdE_0{border-top:10px solid #efe6cf}.g78dTtKm_0 ._2DmyW7ex_0:before{background:#e5d8b5}.g78dTtKm_0 ._2DmyW7ex_0 ._1M5b-cvc_0 ._3l55W_ak_0{background:#efe6cf}.g78dTtKm_0 ._3lTiSebX_0{background-color:#efe6cf}._3uMzBYfb_0{background:#353535}._3uMzBYfb_0 ._2LbT9q3y_0,._3uMzBYfb_0 .vJXgmLTi_0{color:silver}._3uMzBYfb_0 ._1qhD3bdE_0{border-top:10px solid #3e3e3e}._3uMzBYfb_0 ._2DmyW7ex_0:before{background:#4c4c4c}._3uMzBYfb_0 ._2DmyW7ex_0 ._1M5b-cvc_0 ._3l55W_ak_0{background:#3e3e3e;color:silver}._3uMzBYfb_0 ._1qhD3bdE_0 h2,._3uMzBYfb_0 ._2DmyW7ex_0 ._1M5b-cvc_0 ._3Ov-zF0e_0{color:silver}._3uMzBYfb_0 ._3lTiSebX_0{background-color:#3e3e3e}._25ls2Q2l_0{margin-bottom:24px}._4ikL8tnR_0{padding-top:40px!important}.gpDqvVI7_0{position:fixed;top:0;bottom:0;width:100%;z-index:-1}</style><style type="text/css">._352wsGxH_0{height:63px}.Wz6esVdU_0{width:100%;height:63px;background:#fff;position:fixed;top:0;left:0;z-index:20;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0 13px;-webkit-box-shadow:0 2px 3px 0 hsla(0,0%,89%,.38);box-shadow:0 2px 3px 0 hsla(0,0%,89%,.38)}._28dOln0j_0{height:40px;width:110px;background-size:110px;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto;cursor:pointer}._1k9ecCKw_0{width:30px;height:30px;padding-top:4px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:start;font-size:14px;color:#444;margin-left:10px;cursor:pointer}._1U_jCCZU_0{-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto}._3oCJiu8W_0{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 13px;background:#fbf5ee;border-radius:15px;height:30px}._7Xrmrbox_0,.gBs4U5qC_0,.JjI7sqpW_0{-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto;color:#fa8919;font-size:13px;font-weight:500;cursor:pointer}.JjI7sqpW_0{font-size:14px}._3lsV2-l9_0{height:13px;width:1px;background:#fa8919;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto;margin-left:10px;margin-right:10px}._1UaW_Eq1_0{position:fixed;top:0;bottom:0;left:0;right:0;z-index:21;background:#fff;-webkit-transform:translateY(-20px);transform:translateY(-20px);opacity:0;visibility:hidden;-webkit-transition:all .3s ease;transition:all .3s ease}._1UaW_Eq1_0._2mIjHHvm_0{-webkit-transform:translateY(0);transform:translateY(0);opacity:1;visibility:visible}._1qHJ5OLn_0{height:63px;-ms-flex-align:center;padding-left:15px;padding-right:15px;-webkit-box-shadow:0 2px 3px 0 hsla(0,0%,89%,.38);box-shadow:0 2px 3px 0 hsla(0,0%,89%,.38)}._1qHJ5OLn_0,._2FYmyQEJ_0{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;align-items:center}._2FYmyQEJ_0{-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;height:35px;-ms-flex-align:center;border-radius:20px;padding-left:20px;padding-right:20px}._1CLulytQ_0{font-size:14px;color:#b2b2b2}._1reF0JJk_0{height:20px;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;margin-left:10px}._1reF0JJk_0 input{background:transparent;border:0;color:#353535;height:20px;line-height:20px;font-size:14px;width:100%;vertical-align:top;outline:none}._33xQ4nNG_0{font-size:16px;font-weight:400;color:#b2b2b2;height:30px;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:flex;margin-left:20px}._1y_WRr3L_0{font-size:18px}._1y_WRr3L_0 ._2HnUZhdg_0{color:#888;font-weight:400;padding-left:28px;height:63px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-bottom:1px solid #eee}._1y_WRr3L_0 ._2HnUZhdg_0._1r7t-t9P_0{color:#fa8919}._3IeMxVb7_0{position:absolute;bottom:40px;left:0;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-pack:distribute;justify-content:space-around}._3IeMxVb7_0 ._2HnUZhdg_0{position:relative;padding-top:46px;color:#888}._3IeMxVb7_0 ._339_Pvt6_0{position:absolute;color:#c3c3c3;height:46px;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;font-size:36px;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;top:0;left:0}</style><style type="text/css">._2SACi4xg_0{line-height:0}._2SACi4xg_0 img{vertical-align:top;margin-left:20px;opacity:.5}</style><style type="text/css">._1Bg5E78Y_0{width:100%;height:60px;background:#fff;-webkit-transition:background-color .3s ease;transition:background-color .3s ease;-webkit-box-sizing:border-box;box-sizing:border-box;padding-left:18px;padding-right:12px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;border-radius:6px 30px 30px 6px;-webkit-box-shadow:0 3px 25px 4px rgba(140,163,191,.14);box-shadow:0 3px 25px 4px rgba(140,163,191,.14)}._1Bg5E78Y_0 ._2Ha38TVL_0{border-radius:50%;width:40px;height:40px;-webkit-box-shadow:0 1px 3px 2px rgba(0,0,0,.1);box-shadow:0 1px 3px 2px rgba(0,0,0,.1);position:relative}._1Bg5E78Y_0 ._1iA2uC1V_0{background-repeat:no-repeat;background-position:0 0;background-size:300px;background-color:#fff;border-radius:50%;width:40px;height:40px;position:absolute;top:0;left:0}._1Bg5E78Y_0 ._1WF5YSBJ_0{background:rgba(0,0,0,.15)}._1Bg5E78Y_0 ._2Kms_g0F_0{width:40px;height:40px;line-height:40px;text-align:center;border-radius:50%;z-index:2;position:relative}._1Bg5E78Y_0 .MH1rcCm7_0 ._2Kms_g0F_0{color:#fff;margin-left:2px}._1Bg5E78Y_0 ._1KuRDTHn_0 ._2Kms_g0F_0{color:#fff}._1Bg5E78Y_0 .MH1rcCm7_0 ._1iA2uC1V_0{-webkit-animation:HvzpPu2i_0 4s linear infinite;animation:HvzpPu2i_0 4s linear infinite;-webkit-animation-play-state:paused;animation-play-state:paused}._1Bg5E78Y_0 ._1KuRDTHn_0 ._1iA2uC1V_0{-webkit-animation:HvzpPu2i_0 4s linear infinite;animation:HvzpPu2i_0 4s linear infinite;-webkit-animation-play-state:running;animation-play-state:running}._1Bg5E78Y_0 ._1qj_iPD7_0{-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;overflow:hidden;margin-right:10px}._1Bg5E78Y_0 ._1qj_iPD7_0 h3{color:#404040;font-size:15.25px;margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}._1Bg5E78Y_0 ._1qj_iPD7_0 p{margin:0;margin-top:.125rem;font-size:12px;font-weight:500;line-height:1rem;color:#999}._1Bg5E78Y_0 ._3PhVtlEa_0{width:20px;height:20px;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto;position:relative;color:#999;font-size:18px;line-height:20px;text-align:center;margin-right:20px}._1Bg5E78Y_0 ._1l6e3976_0{width:10px;height:10px;line-height:10px;text-align:center;position:absolute;bottom:-3px;right:-5px;color:#6c0;background:#fff;font-size:10px;-webkit-transition:background-color .2s ease;transition:background-color .2s ease}._1W0qSnju_0{-webkit-box-shadow:0 3px 25px 4px hsla(42,28%,65%,.14);box-shadow:0 3px 25px 4px hsla(42,28%,65%,.14)}._1W0qSnju_0,._1W0qSnju_0 ._1l6e3976_0{background:#f6f0e0}._1W0qSnju_0 ._2Ha38TVL_0{-webkit-box-shadow:0 1px 2px 2px hsla(42,28%,65%,.14);box-shadow:0 1px 2px 2px hsla(42,28%,65%,.14)}._2SRR-E_O_0{background:#4d4d4d;-webkit-box-shadow:none;box-shadow:none}._2SRR-E_O_0 ._3PhVtlEa_0{color:#fff}._2SRR-E_O_0 ._1l6e3976_0{background:#4d4d4d}._2SRR-E_O_0 ._1qj_iPD7_0 h3,._2SRR-E_O_0 ._1qj_iPD7_0 p{color:silver}._2vBNygJQ_0 ._1qj_iPD7_0 p{font-weight:700}@-webkit-keyframes HvzpPu2i_0{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes HvzpPu2i_0{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}</style><style type="text/css">._29HP61GA_0{font-weight:400;color:#353535;line-height:1.76;white-space:normal;word-break:normal;font-size:17px;-webkit-transition:background-color .3s ease;transition:background-color .3s ease}._29HP61GA_0 .MathJax_Display{overflow:auto}._29HP61GA_0 .poster{position:fixed;left:-10000px;top:-10000px;overflow:hidden;padding:1rem;background:#ececec}._29HP61GA_0 .richcontent-pre-copy{font-size:13px;color:#888;position:absolute;right:1em;top:.5em;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}._29HP61GA_0 .richcontent-pre-copy .iconfont{font-size:12px;margin-right:.2em}._29HP61GA_0 a{color:#fa8919;border-bottom:1px solid #fa8919}._29HP61GA_0 img{display:block;max-width:100%;position:relative;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%);background-color:#eee;vertical-align:top;border-radius:0}._29HP61GA_0 audio,._29HP61GA_0 video{width:100%;background-color:#eee}._29HP61GA_0 pre{margin-top:16px;padding:34px 0 0;margin-bottom:30px;position:relative;border-radius:6px;background:rgba(246,247,251,.749);border:0}._29HP61GA_0 pre code{font-size:12px;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;display:block;-webkit-box-sizing:border-box;box-sizing:border-box;margin-left:16px;margin-right:16px;overflow-x:scroll}._29HP61GA_0 pre code:after{content:"";height:30px;width:100%;display:block}._29HP61GA_0 hr{border:none;margin-top:1.5rem;margin-bottom:1.5rem;border-top:1px solid #f5f5f5;height:1px;background:none}._29HP61GA_0 h1,._29HP61GA_0 h2,._29HP61GA_0 h3,._29HP61GA_0 h4,._29HP61GA_0 h5{margin-bottom:20px;margin-top:0;font-weight:700;color:#353535}._29HP61GA_0 b,._29HP61GA_0 strong{font-weight:700;color:#353535}._29HP61GA_0 h1{font-size:21px}._29HP61GA_0 h2{font-size:20px}._29HP61GA_0 h3{font-size:19px}._29HP61GA_0 h4{font-size:18px}._29HP61GA_0 h5{font-size:17px}._29HP61GA_0 center,._29HP61GA_0 p{font-weight:400;color:#353535;margin-top:0;margin-bottom:30px;word-break:break-word}._29HP61GA_0 center{text-align:center}._29HP61GA_0 blockquote{margin-top:0;margin-bottom:34px;border-left:3px solid #e8e8e8;padding-left:17px;color:#353535}._29HP61GA_0 blockquote p{margin-top:0;margin-bottom:0}._29HP61GA_0 ol,._29HP61GA_0 ul{margin-bottom:30px}._29HP61GA_0 ol p,._29HP61GA_0 ul p{margin-top:0;margin-bottom:0}._29HP61GA_0 ol{list-style:decimal;margin-left:20px}._29HP61GA_0 ul li{padding-left:17px;position:relative;margin-bottom:10px}._29HP61GA_0 ul li:after{content:"";height:6px;width:6px;border-radius:50%;background:#353535;position:absolute;top:10px;left:0}._29HP61GA_0 .orange{color:#fa8919}._29HP61GA_0 .reference{color:#888}._29HP61GA_0 .m-right{text-align:right}._29HP61GA_0 .m-center{text-align:center;display:block}._29HP61GA_0 .m-gray{color:#888}._29HP61GA_0 .m-small{font-size:15px}._29HP61GA_0 table.hljs-ln{margin-bottom:0;border-spacing:0;border-collapse:collapse}._29HP61GA_0 table.hljs-ln,._29HP61GA_0 table.hljs-ln tbody,._29HP61GA_0 table.hljs-ln td,._29HP61GA_0 table.hljs-ln tr{-webkit-box-sizing:border-box;box-sizing:border-box}._29HP61GA_0 table.hljs-ln td{padding:0;border:0}._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers{min-width:15px;font-size:12px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}._29HP61GA_0 table.hljs-ln td.hljs-ln-code,._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:20px;vertical-align:top}._29HP61GA_0 table.hljs-ln td.hljs-ln-code{position:relative;padding-right:10px;padding-left:10px;overflow:visible;font-size:13px;color:#666;word-wrap:normal;white-space:pre}._2gMcXXSK_0{font-size:15px}._2gMcXXSK_0 h1{font-size:19px}._2gMcXXSK_0 h2{font-size:18px}._2gMcXXSK_0 h3{font-size:17px}._2gMcXXSK_0 h4{font-size:16px}._2gMcXXSK_0 h5{font-size:15px}._2gMcXXSK_0 p{margin-bottom:26px}._2gMcXXSK_0 blockquote{margin-bottom:30px}._2gMcXXSK_0 ol,._2gMcXXSK_0 ul{margin-bottom:26px}._2gMcXXSK_0 .m-small{font-size:13px}._1-IhkAAb_0{font-size:19px}._1-IhkAAb_0 h1{font-size:23px}._1-IhkAAb_0 h2{font-size:22px}._1-IhkAAb_0 h3{font-size:21px}._1-IhkAAb_0 h4{font-size:20px}._1-IhkAAb_0 h5{font-size:19px}._1-IhkAAb_0 .m-small{font-size:17px}._1Xjr5LRK_0 table.hljs-ln td.hljs-ln-code,._1Xjr5LRK_0 table.hljs-ln td.hljs-ln-numbers{font-family:monospace}._1XhbM4Sp_0 pre{background:hsla(43,50%,87%,.749)}._1XhbM4Sp_0 blockquote{border-color:#efe6cf}._2wERfXHe_0 h1,._2wERfXHe_0 h2,._2wERfXHe_0 h3,._2wERfXHe_0 h4,._2wERfXHe_0 h5,._2wERfXHe_0 p{color:silver}._2wERfXHe_0 blockquote{border-color:#3e3e3e}._2wERfXHe_0 li,._2wERfXHe_0 strong{color:silver}._2wERfXHe_0 pre{background:rgba(62,62,62,.749)}._2wERfXHe_0 center{color:silver}._2wERfXHe_0 img{opacity:.9}._2wERfXHe_0 ul li:after{background:silver}._2wERfXHe_0 table.hljs-ln td.hljs-ln-numbers{color:#b2b2b2}._2wERfXHe_0 table.hljs-ln td.hljs-ln-code{color:silver}</style><style type="text/css">.reJj6Thl_0{list-style-position:inside;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-top:40px}.reJj6Thl_0 a{border-bottom:none}.reJj6Thl_0 ._2273kGdT_0{width:35px;height:35px;-ms-flex-negative:0;flex-shrink:0;border-radius:50%}.reJj6Thl_0:last-child ._2CG0SquK_0{border-bottom:none}.reJj6Thl_0 ._2CG0SquK_0{margin-left:.5rem;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;padding-bottom:25px;border-bottom:.5px solid #e8e8e8;-webkit-transition:border-bottom .3s ease;transition:border-bottom .3s ease;overflow:hidden}.reJj6Thl_0 ._2CG0SquK_0 ._304R4gla_0{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;padding-bottom:10px}.reJj6Thl_0 ._2CG0SquK_0 ._3M6kV3zb_0{color:#4c4c4c;font-size:16px;font-weight:400;white-space:normal;word-break:normal;line-height:1.6;overflow:hidden;display:-webkit-box;-webkit-line-clamp:5;-webkit-box-orient:vertical}.reJj6Thl_0 ._2CG0SquK_0 ._3D2NkqD6_0{overflow:auto;-webkit-line-clamp:unset}.reJj6Thl_0 ._2CG0SquK_0 ._1H1Z49Dr_0{color:#888;font-size:11px;line-height:1;margin-top:4px}.reJj6Thl_0 ._2CG0SquK_0 ._18Dng5rT_0{color:#353535;font-size:14px;font-weight:700;height:20px;line-height:20px}.reJj6Thl_0 ._1bkbsnjg_0{height:15px;line-height:15px;width:30px;overflow:hidden;font-size:10px;color:#fff;background:#cbcbcb;text-align:center;display:inline-block;border-radius:3px;vertical-align:top;margin-top:2px}.reJj6Thl_0 ._2eMTs2JE_0{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:26px}.reJj6Thl_0 ._1YQBH3WC_0{color:#999;font-size:13px;margin-left:42px;width:20px;text-align:center}.reJj6Thl_0 ._13n1j2Zp_0{color:#999;font-size:11px;width:20px;margin-left:38px;text-align:center}.reJj6Thl_0 ._2P4B1Hdm_0{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:15.25px;text-decoration:none}.reJj6Thl_0 ._2P4B1Hdm_0 i{color:#999;display:inline-block;font-size:15px;margin-right:4px;height:27px;width:15px;margin-top:-2px}.reJj6Thl_0 ._2P4B1Hdm_0 i._2A421P4G_0background-size:15px}.reJj6Thl_0 ._2P4B1Hdm_0 span{color:#888;font-size:13px;font-weight:400}.reJj6Thl_0 ._2P4B1Hdm_0 span._2A421P4G_0{color:#fa8919}.reJj6Thl_0 ._2r3UB1GX_0{font-size:13px;color:#b2b2b2;height:16px;padding-top:8px}.reJj6Thl_0 ._2r3UB1GX_0 span{font-weight:500}.reJj6Thl_0 ._2r3UB1GX_0 i,.reJj6Thl_0 ._2r3UB1GX_0 span{height:16px;line-height:16px;display:inline-block;vertical-align:top}.reJj6Thl_0 ._2xNIY4NG_0{margin-top:10px}.reJj6Thl_0 ._2xNIY4NG_0 ._33BLbmw4_0{color:#888;font-size:14px;font-weight:400;white-space:normal;word-break:normal;background:#f6f7fb;-webkit-transition:background .3s ease;transition:background .3s ease;border-radius:10px;padding:18px;overflow-x:scroll}.reJj6Thl_0 ._2xNIY4NG_0 ._1H1Z49Dr_0{color:#888;font-size:9px}._0X_LEcd_0 ._2xNIY4NG_0 ._33BLbmw4_0{background:#efe6cf}.cGm0Q9aA_0 ._2CG0SquK_0{border-bottom:1px solid #4c4c4c}.cGm0Q9aA_0 ._2CG0SquK_0 ._1H1Z49Dr_0,.cGm0Q9aA_0 ._2CG0SquK_0 ._3M6kV3zb_0,.cGm0Q9aA_0 ._2CG0SquK_0 ._18Dng5rT_0{color:silver}.cGm0Q9aA_0 ._2xNIY4NG_0 ._33BLbmw4_0{color:silver;background:#3e3e3e}.cGm0Q9aA_0 ._1YQBH3WC_0,.cGm0Q9aA_0 ._2P4B1Hdm_0 i,.cGm0Q9aA_0 ._2P4B1Hdm_0 span,.cGm0Q9aA_0 ._13n1j2Zp_0{color:#999}._2Gn7zqLg_0 ._1bkbsnjg_0{line-height:18px}</style>
    <script id="savepage-pageloader" type="application/javascript">
      savepage_PageLoader(5);
      "use strict";function savepage_PageLoader(maxframedepth){var resourceMimeType=new Array();var resourceBase64Data=new Array();var resourceBlobUrl=new Array();window.addEventListener("DOMContentLoaded",function(a){createBlobURLs();replaceReferences(0,document.documentElement)},false);function createBlobURLs(){var i,j,binaryString,blobData;var a=new Array();for(i=0;i<resourceMimeType.length;i++){if(typeof resourceMimeType[i]!="undefined"){binaryString=atob(resourceBase64Data[i]);resourceBase64Data[i]="";a.length=0;for(j=0;j<binaryString.length;j++){a[j]=binaryString.charCodeAt(j)}blobData=new Blob([new Uint8Array(a)],{type:resourceMimeType[i]});resourceMimeType[i]="";resourceBlobUrl[i]=window.URL.createObjectURL(blobData)}}}function replaceReferences(a,b){var i,regex1,regex2,csstext,blobData;regex1=/url\(\s*((?:"[^"]+")|(?:'[^']+')|(?:[^\s)]+))\s*\)/gi;regex2=/data:[^;]*;if(b.hasAttribute("style")){csstext=b.style.cssText;b.style.cssText=csstext.replace(regex1,replaceCSSRef)}if(b.localName=="style"){csstext=b.textContent;b.textContent=csstext.replace(regex1,replaceCSSRef)}else if(b.localName=="link"&&(b.rel.toLowerCase()=="icon"||b.rel.toLowerCase()=="shortcut icon")){if(b.href!="")b.href=b.href.replace(regex2,replaceRef)}else if(b.localName=="body"){if(b.background!="")b.background=b.background.replace(regex2,replaceRef)}else if(b.localName=="img"){if(b.src!="")b.src=b.src.replace(regex2,replaceRef)}else if(b.localName=="input"&&b.type.toLowerCase()=="image"){if(b.src!="")b.src=b.src.replace(regex2,replaceRef)}else if(b.localName=="audio"){if(b.src!=""){b.src=b.src.replace(regex2,replaceRef);b.load()}}else if(b.localName=="video"){if(b.src!=""){b.src=b.src.replace(regex2,replaceRef);b.load()}if(b.poster!="")b.poster=b.poster.replace(regex2,replaceRef)}else if(b.localName=="source"){if(b.src!=""){b.src=b.src.replace(regex2,replaceRef);b.parentElement.load()}}else if(b.localName=="track"){if(b.src!="")b.src=b.src.replace(regex2,replaceRef)}else if(b.localName=="object"){if(b.data!="")b.data=b.data.replace(regex2,replaceRef)}else if(b.localName=="embed"){if(b.src!="")b.src=b.src.replace(regex2,replaceRef)}if(b.localName=="iframe"||b.localName=="frame"){if(a<maxframedepth){if(b.hasAttribute("data-savepage-sameorigin")){blobData=new Blob([decodeURIComponent(b.src.substr(29))],{type:"text/html;charset=utf-8"});b.onload=function(){try{if(b.contentDocument.documentElement!=null){replaceReferences(a+1,b.contentDocument.documentElement)}}catch(e){}};b.src=window.URL.createObjectURL(blobData)}}}else{for(i=0;i<b.childNodes.length;i++){if(b.childNodes[i]!=null){if(b.childNodes[i].nodeType==1)replaceReferences(a,b.childNodes[i])}}}}function replaceCSSRef(a,b,c,d){var e=new Array();e=b.match(/data:[^;]*;resource=(\d+);base64,/i);if(e!=null)return"url("+resourceBlobUrl[+e[1]]+")";else return a}function replaceRef(a,b,c,d){return resourceBlobUrl[+b]}
        
      }
    </script>
    
    <meta name="savepage-title" content="极客时间 | 从0开始学架构">
    <meta name="savepage-date" content="Sun May 19 2019 23:29:20 GMT+0800 (中国标准时间)">
    
    <meta name="savepage-version" content="13.6">
    <meta name="savepage-comments" content=""></head><body><div id="app"><div class="_3ADRghFH_0" style="background-color: rgb(255, 255, 255);"><div class="gpDqvVI7_0" style="background-color: rgb(255, 255, 255);"></div> <div class="_20-cXID6_0" style="opacity: 1;"><div class="_3O_7qs2p_0 _2q1SuvsS_0"> <!----> <div class="_50pDbNcP_0"><h1 class="vJXgmLTi_0 _2QmGFWqF_0">
        34 | 深入理解微服务架构：银弹 or 焦油坑？
      </h1> <div class="_2LbT9q3y_0 _2QmGFWqF_0"><span>2018-07-14</span> <span>李运华</span> <div class="_3FoXPaWx_0"><span class="YLYfWxsg_0">从0开始学架构</span> <div class="nJKayDbe_0"><span>进入课程</span> <div class="_2k8p2GLU_0 iconfont"></div></div></div></div> <div class="_3Jbcj4Iu_0 _2QmGFWqF_0"><img src="https://static001.geekbang.org/resource/image/6d/30/6d5fc2133a096f4a4f5ef06cc0303c30.jpg"  class="_1-ZfmNK8_0"> <div class="_2SACi4xg_0"></div> <!----> <div class="_1Bg5E78Y_0 _25ls2Q2l_0"><div class="_1qj_iPD7_0"><h3>讲述：黄洲君</h3> <p><span style="margin-right: 3px;">时长</span><span style="margin-right: 10px;">13:44</span><span style="margin-right: 3px;">大小</span><span>6.29M</span></p></div> <!----> <div class="_2Ha38TVL_0 MH1rcCm7_0"> <div class="_1iA2uC1V_0 _1WF5YSBJ_0"></div> <div class="iconfont _2Kms_g0F_0"></div></div> <audio title="34 | 深入理解微服务架构：银弹 or 焦油坑？" res001.geekbang.org/media/audio/17/45/1733b923d138c2e9b213e64b03ef2d45/ld/ld.m3u8" ></audio></div> <div class="_3IatBmhv_0"><div class="_29HP61GA_0"><p>微服务是近几年非常火热的架构设计理念，大部分人认为是 Martin Fowler 提出了微服务概念，但事实上微服务概念的历史要早得多，也不是 Martin Fowler 创造出来的，Martin 只是将微服务进行了系统的阐述（原文链接：<a href="https://martinfowler.com/articles/microservices.html">https://martinfowler.com/articles/microservices.html</a>）。不过不能否认 Martin 在推动微服务起到的作用，微服务能火，Martin 功不可没。</p>
<p>微服务的定义相信你早已耳熟能详，参考维基百科，我就来简单梳理一下微服务的历史吧（<a href="https://en.wikipedia.org/wiki/Microservices#History%EF%BC%89%EF%BC%9A">https://en.wikipedia.org/wiki/Microservices#History）：</a></p>
<ul>
<li>
<p>2005 年：Dr. Peter Rodgers 在 Web Services Edge 大会上提出了“Micro-Web-Services”的概念。</p>
</li>
<li>
<p>2011 年：一个软件架构工作组使用了“microservice”一词来描述一种架构模式。</p>
</li>
<li>
<p>2012 年：同样是这个架构工作组，正式确定用“microservice”来代表这种架构。</p>
</li>
<li>
<p>2012 年：ThoughtWorks 的 James Lewis 针对微服务概念在 QCon San Francisco 2012 发表了演讲。</p>
</li>
<li>
<p>2014 年：James Lewis 和 Martin Fowler 合写了关于微服务的一篇学术性的文章，详细阐述了微服务。</p>
</li>
</ul><!-- [[[read_end]]] -->
<p>由于微服务的理念中也包含了“服务”的概念，而 SOA 中也有“服务”的概念，我们自然而然地会提出疑问：<strong>微服务与 SOA 有什么关系？有什么区别？为何有了 SOA 还要提微服务</strong>？这几个问题是理解微服务的关键，否则如果只是跟风拿来就用，既不会用，也用不好，用了不但没有效果，反而还可能有副作用。</p>
<p>今天我们就来<span class="orange">深入理解微服务，到底是银弹还是焦油坑</span>。</p>
<h2>微服务与 SOA 的关系</h2>
<p>对于了解过 SOA 的人来说，第一次看到微服务这个概念肯定会有所疑惑：为何有了 SOA 还要提微服务呢？等到简单看完微服务的介绍后，可能很多人更困惑了：这不就是 SOA 吗？</p>
<p>关于 SOA 和微服务的关系和区别，大概分为下面几个典型的观点。</p>
<ul>
<li>微服务是 SOA 的实现方式</li>
</ul>
<p>如下图所示，这种观点认为 SOA 是一种架构理念，而微服务是 SOA 理念的一种具体实现方法。例如，“微服务就是使用 HTTP RESTful 协议来实现 ESB 的 SOA”“使用 SOA 来构建单个系统就是微服务”和“微服务就是更细粒度的 SOA”。<br>
<img src="https://static001.geekbang.org/resource/image/47/a8/475b044b5ac353b56650b2dc2dbf6da8.png"  alt=""></p>
<ul>
<li>微服务是去掉 ESB 后的 SOA</li>
</ul>
<p>如下图所示，这种观点认为传统 SOA 架构最广为人诟病的就是庞大、复杂、低效的 ESB，因此将 ESB 去掉，改为轻量级的 HTTP 实现，就是微服务。<br>
<img src="https://static001.geekbang.org/resource/image/cc/09/cccbf05bae9c8419752a3bd7e4febb09.png"  alt=""></p>
<ul>
<li>微服务是一种和 SOA 相似但本质上不同的架构理念</li>
</ul>
<p>如下图所示，这种观点认为微服务和 SOA 只是有点类似，但本质上是不同的架构设计理念。相似点在于下图中交叉的地方，就是两者都关注“服务”，都是通过服务的拆分来解决可扩展性问题。本质上不同的地方在于几个核心理念的差异：是否有 ESB、服务的粒度、架构设计的目标等。<br>
<img src="https://static001.geekbang.org/resource/image/21/88/21db88f92cdcdf4826e837c0d8173b88.png"  alt=""></p>
<p>以上观点看似都有一定的道理，但都有点差别，到底哪个才是准确的呢？单纯从概念上是难以分辨的，我来对比一下 SOA 和微服务的一些具体做法，再来看看到底哪一种观点更加符合实际情况。</p>
<ol>
<li>服务粒度</li>
</ol>
<p>整体上来说，SOA 的服务粒度要粗一些，而微服务的服务粒度要细一些。例如，对一个大型企业来说，“员工管理系统”就是一个 SOA 架构中的服务；而如果采用微服务架构，则“员工管理系统”会被拆分为更多的服务，比如“员工信息管理”“员工考勤管理”“员工假期管理”和“员工福利管理”等更多服务。</p>
<ol start="2">
<li>服务通信</li>
</ol>
<p>SOA 采用了 ESB 作为服务间通信的关键组件，负责服务定义、服务路由、消息转换、消息传递，总体上是重量级的实现。微服务推荐使用统一的协议和格式，例如，RESTful 协议、RPC 协议，无须 ESB 这样的重量级实现。Martin Fowler 将微服务架构的服务通讯理念称为“Smart endpoints and dumb pipes”，简单翻译为“聪明的终端，愚蠢的管道”。之所以用“愚蠢”二字，其实就是与 ESB 对比的，因为 ESB 太强大了，既知道每个服务的协议类型（例如，是 RMI 还是 HTTP），又知道每个服务的数据类型（例如，是 XML 还是 JSON），还知道每个数据的格式（例如，是 2017-01-01 还是 01/01/2017），而微服务的“dumb pipes”仅仅做消息传递，对消息格式和内容一无所知。</p>
<ol start="3">
<li>服务交付</li>
</ol>
<p>SOA 对服务的交付并没有特殊要求，因为 SOA 更多考虑的是兼容已有的系统；微服务的架构理念要求“快速交付”，相应地要求采取自动化测试、持续集成、自动化部署等敏捷开发相关的最佳实践。如果没有这些基础能力支撑，微服务规模一旦变大（例如，超过 20 个微服务），整体就难以达到快速交付的要求，这也是很多企业在实行微服务时踩过的一个明显的坑，就是系统拆分为微服务后，部署的成本呈指数上升。</p>
<ol start="4">
<li>应用场景</li>
</ol>
<p>SOA 更加适合于庞大、复杂、异构的企业级系统，这也是 SOA 诞生的背景。这类系统的典型特征就是很多系统已经发展多年，采用不同的企业级技术，有的是内部开发的，有的是外部购买的，无法完全推倒重来或者进行大规模的优化和重构。因为成本和影响太大，只能采用兼容的方式进行处理，而承担兼容任务的就是 ESB。</p>
<p>微服务更加适合于快速、轻量级、基于 Web 的互联网系统，这类系统业务变化快，需要快速尝试、快速交付；同时基本都是基于 Web，虽然开发技术可能差异很大（例如，Java、C++、.NET 等），但对外接口基本都是提供 HTTP RESTful 风格的接口，无须考虑在接口层进行类似 SOA 的 ESB 那样的处理。</p>
<p>综合上述分析，我将 SOA 和微服务对比如下：<br>
<img src="https://static001.geekbang.org/resource/image/af/a8/affc409d5f4b05616e944001ebae0ba8.png"  alt=""></p>
<p>因此，我们可以看到，<strong>SOA 和微服务本质上是两种不同的架构设计理念，只是在“服务”这个点上有交集而已，因此两者的关系应该是上面第三种观点</strong>。</p>
<p>其实，Martin Fowler 在他的微服务文章中，已经做了很好的提炼：</p>
<blockquote>
<p>In short, the microservice architectural style is an approach to developing a single application as a suite of small services, each running in its own process and communicating with lightweight mechanisms, often an HTTP resource API. These services are built around business capabilities and independently deployable by fully automated deployment machinery.</p>
</blockquote>
<p>（<a href="https://martinfowler.com/articles/microservices.html">https://martinfowler.com/articles/microservices.html</a>）</p>
<p>上述英文的三个关键词分别是：small、lightweight、automated，基本上浓缩了微服务的精华，也是微服务与 SOA 的本质区别所在。</p>
<p>通过前面的详细分析和比较，似乎微服务本质上就是一种比 SOA 要优秀很多的架构模式，那是否意味着我们都应该把架构重构为微服务呢？</p>
<p>其实不然，SOA 和微服务是两种不同理念的架构模式，并不存在孰优孰劣，只是应用场景不同而已。我们介绍 SOA 时候提到其产生历史背景是因为企业的 IT 服务系统庞大而又复杂，改造成本很高，但业务上又要求其互通，因此才会提出 SOA 这种解决方案。如果我们将微服务的架构模式生搬硬套到企业级 IT 服务系统中，这些 IT 服务系统的改造成本可能远远超出实施 SOA 的成本。</p>
<h2>微服务的陷阱</h2>
<p>单纯从上面的对比来看，似乎微服务大大优于 SOA，这也导致了很多团队在实践时不加思考地采用微服务——既不考虑团队的规模，也不考虑业务的发展，也没有考虑基础技术的支撑，只是觉得微服务很牛就赶紧来实施，以为实施了微服务后就什么问题都解决了，而一旦真正实施后才发现掉到微服务的坑里面去了。</p>
<p>我们看一下微服务具体有哪些坑：</p>
<ol>
<li>服务划分过细，服务间关系复杂</li>
</ol>
<p>服务划分过细，单个服务的复杂度确实下降了，但整个系统的复杂度却上升了，因为微服务将系统内的复杂度转移为系统间的复杂度了。</p>
<p>从理论的角度来计算，n 个服务的复杂度是 n×(n-1)/2，整体系统的复杂度是随着微服务数量的增加呈指数级增加的。下图形象了说明了整体复杂度：<br>
<img src="https://static001.geekbang.org/resource/image/82/6f/824b0b0134b6307c71ddfb86f8ac916f.png"  alt=""></p>
<p>粗粒度划分服务时，系统被划分为 3 个服务，虽然单个服务较大，但服务间的关系很简单；细粒度划分服务时，虽然单个服务小了一些，但服务间的关系却复杂了很多。</p>
<ol start="2">
<li>服务数量太多，团队效率急剧下降</li>
</ol>
<p>微服务的“微”字，本身就是一个陷阱，很多团队看到“微”字后，就想到必须将服务拆分得很细，有的团队人员规模是 5 ~ 6 个人，然而却拆分出 30 多个微服务，平均每个人要维护 5 个以上的微服务。</p>
<p>这样做给工作效率带来了明显的影响，一个简单的需求开发就需要涉及多个微服务，光是微服务之间的接口就有 6 ~ 7 个，无论是设计、开发、测试、部署，都需要工程师不停地在不同的服务间切换。</p>
<ul>
<li>
<p>开发工程师要设计多个接口，打开多个工程，调试时要部署多个程序，提测时打多个包。</p>
</li>
<li>
<p>测试工程师要部署多个环境，准备多个微服务的数据，测试多个接口。</p>
</li>
<li>
<p>运维工程师每次上线都要操作多个微服务，并且微服务之间可能还有依赖关系。</p>
</li>
</ul>
<ol start="3">
<li>调用链太长，性能下降</li>
</ol>
<p>由于微服务之间都是通过 HTTP 或者 RPC 调用的，每次调用必须经过网络。一般线上的业务接口之间的调用，平均响应时间大约为 50 毫秒，如果用户的一起请求需要经过 6 次微服务调用，则性能消耗就是 300 毫秒，这在很多高性能业务场景下是难以满足需求的。为了支撑业务请求，可能需要大幅增加硬件，这就导致了硬件成本的大幅上升。</p>
<ol start="4">
<li>调用链太长，问题定位困难</li>
</ol>
<p>系统拆分为微服务后，一次用户请求需要多个微服务协同处理，任意微服务的故障都将导致整个业务失败。然而由于微服务数量较多，且故障存在扩散现象，快速定位到底是哪个微服务故障是一件复杂的事情。下面是一个典型样例。<br>
<img src="https://static001.geekbang.org/resource/image/40/1a/40da615c90698de5b127d974432ac91a.png"  alt=""></p>
<p>Service C 的数据库出现慢查询，导致 Service C 给 Service B 的响应错误，Service B 给 Service A 的响应错误，Service A 给用户的响应错误。我们在实际定位时是不会有样例图中这么清晰的，最开始是用户报错，这时我们首先会去查 Service A。导致 Service A 故障的原因有很多，我们可能要花半个小时甚至 1 个小时才能发现是 Service B 返回错误导致的。于是我们又去查 Service B，这相当于重复 Service A 故障定位的步骤……如此循环下去，最后可能花费了几个小时才能定位到是 Service C 的数据库慢查询导致了错误。</p>
<p>如果多个微服务同时发生不同类型的故障，则定位故障更加复杂，如下图所示。<br>
<img src="https://static001.geekbang.org/resource/image/82/f0/827eca2f541ebd7a55d3ad17cf0db8f0.png"  alt=""></p>
<p>Service C 的数据库发生慢查询故障，同时 Service C 到 Service D 的网络出现故障，此时到底是哪个原因导致了 Service C 返回 Error 给 Service B，需要大量的信息和人力去排查。</p>
<ol start="5">
<li>没有自动化支撑，无法快速交付</li>
</ol>
<p>如果没有相应的自动化系统进行支撑，都是靠人工去操作，那么微服务不但达不到快速交付的目的，甚至还不如一个大而全的系统效率高。例如：</p>
<ul>
<li>
<p>没有自动化测试支撑，每次测试时需要测试大量接口。</p>
</li>
<li>
<p>没有自动化部署支撑，每次部署 6 ~ 7 个服务，几十台机器，运维人员敲 shell 命令逐台部署，手都要敲麻。</p>
</li>
<li>
<p>没有自动化监控，每次故障定位都需要人工查几十台机器几百个微服务的各种状态和各种日志文件。</p>
</li>
</ul>
<ol start="6">
<li>没有服务治理，微服务数量多了后管理混乱</li>
</ol>
<p>信奉微服务理念的设计人员总是强调微服务的 lightweight 特性，并举出 ESB 的反例来证明微服务的优越之处。但具体实践后就会发现，随着微服务种类和数量越来越多，如果没有服务治理系统进行支撑，微服务提倡的 lightweight 就会变成问题。主要问题有：</p>
<ul>
<li>
<p>服务路由：假设某个微服务有 60 个节点，部署在 20 台机器上，那么其他依赖的微服务如何知道这个部署情况呢？</p>
</li>
<li>
<p>服务故障隔离：假设上述例子中的 60 个节点有 5 个节点发生故障了，依赖的微服务如何处理这种情况呢？</p>
</li>
<li>
<p>服务注册和发现：同样是上述的例子，现在我们决定从 60 个节点扩容到 80 个节点，或者将 60 个节点缩减为 40 个节点，新增或者减少的节点如何让依赖的服务知道呢？</p>
</li>
</ul>
<p>如果以上场景都依赖人工去管理，整个系统将陷入一片混乱，最终的解决方案必须依赖自动化的服务管理系统，这时就会发现，微服务所推崇的“lightweight”，最终也发展成和 ESB 几乎一样的复杂程度。</p>
<h2>小结</h2>
<p>今天我为你讲了微服务与 SOA 的关系以及微服务实践中的常见陷阱，希望对你有所帮助。</p>
<p>这就是今天的全部内容，留一道思考题给你吧，你们的业务有采用微服务么？谈谈具体实践过程中有什么经验和教训。</p>
<p>欢迎你把答案写到留言区，和我一起讨论。相信经过深度思考的回答，也会让你对知识的理解更加深刻。（编辑乱入：精彩的留言有机会获得丰厚福利哦！）</p>
<p><img src="https://static001.geekbang.org/resource/image/ba/37/ba6fcd186893b8cc9977d18e1fa5ab37.jpg"  alt=""></p>
</div></div> <!----> <div class="_22WJb59B_0">
        </div></div> <div class="_2DmyW7ex_0 _2QmGFWqF_0"><div class="_1M5b-cvc_0"><div class="_3l55W_ak_0">上一篇</div> <div class="_3Ov-zF0e_0">33 | 传统的可扩展架构模式：分层架构和SOA</div></div> <div class="_1M5b-cvc_0"><div class="_3l55W_ak_0">下一篇</div> <div class="_3Ov-zF0e_0">35 | 微服务架构最佳实践 - 方法篇</div></div></div> <div class="_1qhD3bdE_0 _2QmGFWqF_0"><div class="iconfont _2-nZIZjB_0"> 写留言</div> <h2><span>精选留言</span><span class="_2FC_cD1O_0">(59)</span></h2> <ul><li class="reJj6Thl_0"><img  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>Tom</span> <span class="_1bkbsnjg_0">置顶</span></div> <div class="_1H1Z49Dr_0">2018-08-10</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">3</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0 _3D2NkqD6_0">我们公司的实践是比较粗粒度的子系统或服务，基本上没有太细粒度的微服务，以webapi为主。感觉更像微服务架构，只是服务粒度比较粗，从概念上算是SOA还是微服务架构呢？</div> <!----> <div class="_2xNIY4NG_0"><p class="_33BLbmw4_0">作者回复: 我理解算微服务，千万不要理解为微服务就是将服务拆的很细，后面有具体实践技巧介绍这部分</p></div></div></li><li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/87/57/645159ee.jpg"  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>鹅米豆发</span> <!----></div> <div class="_1H1Z49Dr_0">2018-07-16</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">30</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0">对于一个新事物的诞生，本能地套用已有的知识。特别是一个并不简单的东西，这算是一种高效的入门方法。微服务架构其实相当复杂，我是分成好几个阶段理解。<br><br>1、第一阶段，微服务架构就是去掉了ESB的SOA架构，只不过是通信的方式和结构变了。对于初级的使用者而言，这样理解没有太大问题。<br><br>2、第二阶段，没有了ESB，原本很多由ESB组件做的事儿，转到服务的提供者和调用者这里了。他们需要考虑服务的拆分粒。大体仍然算是SOA架构。<br><br>3、第三阶段，随着服务的数量大幅增加，服务的管理越来越困难，此时DevOps出现了。这个阶段的微服务架构，已经是跟SOA架构完全不同的东西了。<br><br>之前给一家大国企分享过一些经验。他们想从传统架构，转向微服务架构。<br><br>1、建设好基础设施，RPC、服务治理、日志、监控、持续集成、持续部署、运维自动化是基本的，其它包括服务编排、分布式追踪等。<br><br>2、要逐步演进和迭代，不要过于激进，更不要拆分过细，拆分的粒度，要与团队的架构相互匹配。（康威定律）<br><br>3、微服务与数据库方面，是个很大的难点，可以深入了解下领域驱动设计，做好领域建模，特别是数据库要随着服务一起拆分。<br><br>说完上面这些，他们的研发负责人说，我说的跟他们的架构师说的不一样，他们的架构师说，微服务就是各种拆分，不顾一切地拆分。</div> <div class="_2r3UB1GX_0"><span>展开</span><i class="iconfont"></i></div> <div class="_2xNIY4NG_0"><p class="_33BLbmw4_0">作者回复: 他们架构师是水货你的理解和分析是对的，后一篇就讲了</p></div></div></li><li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/a8/1b/ced1d171.jpg"  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>空档滑行</span> <!----></div> <div class="_1H1Z49Dr_0">2018-07-14</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">18</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0">之前一家公司搞了一次完整的微服务改造，享受到了一些好处，但是文中说到的问题，大部分都碰上了。<br>先说下好处，原来的单体应用都服务化了，扩容简单很多。功能隔离后之前一个bug导致系统挂掉的现象没了。问题责任定位划分的更清楚，比如之前大量慢sql无人管，现在通过监控快速找到开发责任人。<br>再说下坏处，1.服务太多了，人不够啊。之前的架构师按照小的原则，把数据层，服务层，应用层严格拆分。一个人手上超过10几个服务...<br>2.服务化不彻底，太多事手工干。服务监控只能监控一半指标，各种远程调用异常没人解决。运维只有打包发布做了自动化。可以想象下开发人员基本下改bug和发布的死循环中。服务网关没有，服务调用就是一张密密麻麻的网<br>3.培训不到位，直接上阵，开发人员对微服务理解不到位，服务质量可想而知<br>4.没有专职测试，自动化测试靠开发写脚本，谁有空啊，单元测试能写一个就算相当有觉悟了<br>总结下来，做服务化改造首先问自己这些问题，业务真的需要微服务来解决吗？真的所有模块的问题都要微服务来解决吗？技术人员的配置和水平达到要求了吗？<br></div> <div class="_2r3UB1GX_0"><span>展开</span><i class="iconfont"></i></div> <!----></div></li><li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/1d/8e/0a546871.jpg"  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>凡凡</span> <!----></div> <div class="_1H1Z49Dr_0">2018-07-16</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">7</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0">说到微服务，切分的粒度和基础设施都致关重要。<br><br>经历的项目有创业初期的单体服务，也有不太完善的服务切分的系统，也有微服务基础设施相对完善的公司。<br><br>单体服务致命就致命在随着项目的发展，项目会越来越臃肿，越不利于扩展开发。<br><br>微服务过程怕就怕基础不完善，人员配备不够盲目切分，导致工程师开发和维护的战线拉长，特别疲惫和泄气，容易产生一种抱怨的大气氛，从而导致微服务失败，重新合并一部分服务。<br><br>微服务做的好的，也有所经历，公司的基础设施完全云化和统一管理，申请几台机器，一套缓存集群，一套mq，sql/nosql…特别容易，工程师愿意建独立的工程，因为很容易构建和部署。这种感觉有点像svn和git，git建分支特别轻量，大家都愿意用分支管理自己的代码，迭代开发，应急处理都能自由切换，得心应手。<br><br>现在遇到一个问题，就是微服务内部系统大多使用rpc，但对接外部系统，或者跨外网传输到客户端就需要http-rest类的协议。也就是我们常说的网关，如果是纯http就很容易做到通用的转发机制，但是http转rpc就不知道有什么方式可以做到通用转发了，内部每增加一个rpc，网关就需要增加一个对应的服务处理逻辑。不知道，这个问题，有没有好的解决办法？</div> <div class="_2r3UB1GX_0"><span>展开</span><i class="iconfont"></i></div> <div class="_2xNIY4NG_0"><p class="_33BLbmw4_0">作者回复: 把HTTP转RPC做成规则，别硬编码每个接口，例如，规定HTTP URL为/service/interface/method?para1=xxx&amp;para2=yyy</p></div></div></li><li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/ed/68/737f97c8.jpg"  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>ant</span> <!----></div> <div class="_1H1Z49Dr_0">2018-07-16</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">6</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0">我们是一家社交公司，后端加厚的演变符合dubbo官网的那张图，在Mvc架构坚持了一年后，业务越来越大，工程越来越臃肿。后面我们一致同意进行服务话，开始用了dubbo。后面由于决策层的原因没有上，后面来了个架构师，又重启了服务拆分，到现在已经用于生产。我们使用的是Spring cloud，现在拆分暴露了很多问题:<br>1、个别服务没有熔断出来，出现过雪崩效应<br>2、服务拆分过细，服务调用链过长<br>3、开发人员能力不一样，代码水平不一样<br>4、没有监控措施<br>5、每个服务部署多台，日志查询就会死人的感觉<br>6、开发过程中经常出现访问不到该访问的接口，这是因为开发人员经常启动本地服务，就会导致30%的概率访问不到<br>7、使用了不合理的持久层框架，使用了JPA访问<br>大概就有上面的问题，总之微服务不是银弹，用得不好会发现无穷无尽的坑。当然，出现问题解决问题就是了。唯一的就像CEO说的: 你们他妈的是完全在拿用户当小白鼠使用</div> <div class="_2r3UB1GX_0"><span>展开</span><i class="iconfont"></i></div> <div class="_2xNIY4NG_0"><p class="_33BLbmw4_0">作者回复: 用户会用脚投票的</p></div></div></li><li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/f6/80/7dfdd3e3.jpg"  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>Neal</span> <!----></div> <div class="_1H1Z49Dr_0">2018-07-16</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">4</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0 _3D2NkqD6_0">1. 数据库拆不开<br>2. 人手不够就两人</div> <!----> <!----></div></li><li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/e1/a9/2774e870.jpg"  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>孤独患者</span> <!----></div> <div class="_1H1Z49Dr_0">2018-07-15</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">4</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0 _3D2NkqD6_0">我们公司的平台就是使用微服务架构，十多二十个微服务，但是没有自动化部署，监控，自动化测试这些，而且每次报错日志也特别难找，但是我们那架构师却不重视这些，只想继续升级平台的功能</div> <!----> <div class="_2xNIY4NG_0"><p class="_33BLbmw4_0">作者回复: 让你们架构师来订阅架构专栏</p></div></div></li><li class="reJj6Thl_0"><img  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>木头旮瘩</span> <!----></div> <div class="_1H1Z49Dr_0">2018-12-12</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">3</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0 _3D2NkqD6_0">让我想起了一次面试经历，一家小公司，技术团队大概7 8个人，然后他们要进行微服务架构改造，我问他们:你们这样满足康威定理么？他们一脸懵逼……我就果断闪人了</div> <!----> <div class="_2xNIY4NG_0"><p class="_33BLbmw4_0">作者回复: 你可以去改造他们</p></div></div></li><li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/7b/36/fd46331c.jpg"  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>Jussi Lee</span> <!----></div> <div class="_1H1Z49Dr_0">2018-09-18</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">3</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0">我们项目之前是把数据采集，和展示都是我们Java组去写的。后面公司为了统一，把采集部分交给了.net组。我们Java只负责数据展示。但是我们这边又按照领导的要求把整个业务拆分为模板解析层-》api层——》终端层。现在每次最烦的事就是找bug。一直感觉现阶段我们的任务和目标没有这么庞大，这与架构中的简单和合适原则想违背。搞的整个项目组一直在反复的开发工作中。都很心累</div> <div class="_2r3UB1GX_0"><span>展开</span><i class="iconfont"></i></div> <div class="_2xNIY4NG_0"><p class="_33BLbmw4_0">作者回复: 很好的案例</p></div></div></li><li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/fe/c5/3467cf94.jpg"  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>正是那朵玫...</span> <!----></div> <div class="_1H1Z49Dr_0">2018-07-14</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">3</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0">我们的业务也算是微服务吧，    接手项目时，已经有好多服务，主要采用的语言有java，php，nodejs，存在以下问题：<br>1、没有一个统一的网关服务，前端请求后端服务都需要后端的服务A来充当安全校验，权限校验等，A服务充当了多重职责，变的职责不明确了，后来抽出网关系统，负责平台统一的流量入口。在构建微服务网关系统是至关重要的。<br>2、监控系统不完善，调用链跟踪，异常报警都不完善，对微服务是巨坑，查找问题如同一场噩梦，调用链很长，一旦发生异常不知道到底哪里出现问题，得一个一个去找。后来慢慢完善，变得好了很多，问题很快定位。<br>3、加入网关后，没有一个统一的服务发现注册中心，网关的路由依靠人工手动配置，变的很麻烦，也很容易出错。后来引入consul，得到改善。</div> <div class="_2r3UB1GX_0"><span>展开</span><i class="iconfont"></i></div> <div class="_2xNIY4NG_0"><p class="_33BLbmw4_0">作者回复: spring全家桶，你值得拥有</p></div></div></li><li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/7f/ec/6cbc04d3.jpg"  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>冬阳(Wolf...</span> <!----></div> <div class="_1H1Z49Dr_0">2018-11-08</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">2</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0">我个人比较认同康威定律，微服务的拆分粒度一定要和组织结构匹配起来，组织结构和开发管理模式是微服务粒度的最重要参考指标之一。</div> <div class="_2r3UB1GX_0"><span>展开</span><i class="iconfont"></i></div> <div class="_2xNIY4NG_0"><p class="_33BLbmw4_0">作者回复: 是的，康威定律和微服务拆分是相关的</p></div></div></li><li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/a1/d7/fb836ffc.jpg"  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>三棱镜</span> <!----></div> <div class="_1H1Z49Dr_0">2018-08-17</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">2</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0">我们目前全部微服务，踩坑踩了不少，拆分服务同时要把自动化运维系统和多维度监控系统，包括问题定位跟踪系统建立起来，要不然拆了就是噩梦。</div> <div class="_2r3UB1GX_0"><span>展开</span><i class="iconfont"></i></div> <div class="_2xNIY4NG_0"><p class="_33BLbmw4_0">作者回复: 感同身受啊</p></div></div></li><li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/a1/e6/50da1b2d.jpg"  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>旭东</span> <!----></div> <div class="_1H1Z49Dr_0">2018-08-09</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">2</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0">个人觉得SOA只是提出了面向服务的编程，到但没有对服务粒度的定义，以及服务的治理问题做深入的分析。<br>提出微服务主要是为了解决面向服务架构后如何能够在实际工程中带来真正的红利。<br>微服务对SOA的技术关键点给出了指导意见。<br><br><br>微服务对分布式服务的诱惑力的确很大，但做但微服务都不会免费的，需要很多的基础设施来做铺垫和基石，才有可能搞定。<br><br>除了基础设施还有很多设计思想需要学习，我觉得DDD就是微服务的绝配。<br><br></div> <div class="_2r3UB1GX_0"><span>展开</span><i class="iconfont"></i></div> <div class="_2xNIY4NG_0"><p class="_33BLbmw4_0">作者回复: SOA是完整的解决方案哦，IBM等公司卖ESB都卖了好多钱</p></div></div></li><li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/4b/d4/b7719327.jpg"  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>波波安</span> <!----></div> <div class="_1H1Z49Dr_0">2018-07-15</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">2</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0">我们用的是dubbo。最开始系统要快速上线，所以服务拆分的不彻底。订单，商品，店铺等这些服务都没有进行拆分。就把支付和营销两个服务拆分出来了。服务拆分不彻底经常导致一个业务有问题。整个系统都用不了。</div> <div class="_2r3UB1GX_0"><span>展开</span><i class="iconfont"></i></div> <div class="_2xNIY4NG_0"><p class="_33BLbmw4_0">作者回复: 不是拆分有问题，是配套基础设施有问题</p></div></div></li><li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/c5/68/7afb7304.jpg"  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>narry</span> <!----></div> <div class="_1H1Z49Dr_0">2018-07-14</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">2</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0 _3D2NkqD6_0">我弄微服务遇到最大的坑，就是jvm与docker兼容性不好，导致每个微服务会消耗过多不必要的内存，我感觉从资源消耗上来说，java开发的微服务都不能算是微服务了，最近在转向go来改造</div> <!----> <div class="_2xNIY4NG_0"><p class="_33BLbmw4_0">作者回复: 这还真是第一次听说jvm与docker不兼容，看看是不是有bug<br></p></div></div></li><li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLwSoTjHPX5tm4whBSfoZLX6toZxrZGUaLABQywKNf4MDc9toK3QSV7Z99ATcGicFCysoleQ5ISzmw/132" src="" class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>乘风</span> <!----></div> <div class="_1H1Z49Dr_0">2018-12-11</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">1</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0">16年时，架构师引入了微服务架构，架构设计分为三层：网关层、业务处理层、数据处理层（getaway-&gt;ls&gt;ds），自上而下依赖，业务层之间也互相依赖，构建过程中发现引入了分布式事务和调用链长（调用链的消耗时间无法接受），经常无故报错，定位问题慢，测试复杂等问题，而我们的大多数业务相对简单，所以重新划分服务粒度，分为两层：网关层：提供路由功能，业务处理层：处理请求，业务层中间可以相互调用，当出现有出现分布式事务时，采取MQ或者更新状态的方式解决，如果是充值+业务订单的这种会直接在一个事务里处理（其实这里就混乱一点了），层与层之间没有完全隔离，但是将调用链缩短，我觉得采用微服务架构确实解决了单体应用的一些问题，如资源问题（但消耗资源是比以前多的）、耦合问题、快速迭代问题，服务与服务的职责更加清晰，不同的服务粒度设计的系统是天差地别的。</div> <div class="_2r3UB1GX_0"><span>展开</span><i class="iconfont"></i></div> <div class="_2xNIY4NG_0"><p class="_33BLbmw4_0">作者回复: 是的，粒度太重要了</p></div></div></li><li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/69/11/831cec7d.jpg"  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>小寞子。(...</span> <!----></div> <div class="_1H1Z49Dr_0">2018-09-21</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">1</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0">我看现在istio还有 kubernetes好像就是为了解决上面微服务的毛病的。 包括服务之间的关系 自动化测试部署，服务可视化差错。容错。熔断等等。 。 还有关于soa和微服务的区别，有个说法是 soa基于企业系统差分，微服务基于business服务拆分</div> <div class="_2r3UB1GX_0"><span>展开</span><i class="iconfont"></i></div> <div class="_2xNIY4NG_0"><p class="_33BLbmw4_0">作者回复: 是的，istio就是想屏蔽微服务的基础设施，让业务系统不需要感知基础设施。<br><br>bussiness可大可小，甚至可以比soa还大，因此不要这样理解微服务</p></div></div></li><li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/5b/30/9dcf35ff.jpg"  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>森林</span> <!----></div> <div class="_1H1Z49Dr_0">2018-09-20</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">1</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0">概念是会一直演化的，我相信最初的SOA的概念就是作者所说的形式，但是仅仅从"面向服务的架构"这几个字来说，难道他就不能是微服务的超集么？在微服务名字出来前，用dubbo的系统是怎么称呼其架构的？微服务定义一开始还要求一定是基于Rest的，难道用dubbo的就不是了？所以个人觉得，理解历史可以，但限定于SOA就一定是基于ESB做协议转换联通各个系统的一种架构是不妥的。</div> <div class="_2r3UB1GX_0"><span>展开</span><i class="iconfont"></i></div> <div class="_2xNIY4NG_0"><p class="_33BLbmw4_0">作者回复: 如果从历史产生的背景去理解，那就每个人都有自己的理解，没法沟通交流呢</p></div></div></li><li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/cf/bb/94c4b9bb.jpg"  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>孙振超</span> <!----></div> <div class="_1H1Z49Dr_0">2018-09-09</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">1</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0">之前是一个系统承载所有功能，对应几十个开发，每次的发布都会有一个痛苦的冲突解决的过程。<br><br>采用微服务首先是理念转变的过程，从一个系统一个数据库切分为多个系统多个数据库，确实会给问题定位排查带上很大的麻烦，每次一个业务功能的更迭需要多个系统共同参与，中间的需求宣讲、排期、联调、确定发布依赖和发布计划增加了不少工作量。<br><br>个人认为最为重要的要有包含全方位立体的监控、链路排查、服务依赖、jia包依赖、服务器部署结构等能力的强大的基础设施，这将极大的提升整体效率。</div> <div class="_2r3UB1GX_0"><span>展开</span><i class="iconfont"></i></div> <div class="_2xNIY4NG_0"><p class="_33BLbmw4_0">作者回复: spring全家桶，你值得拥有</p></div></div></li><li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/d3/3c/ab6425f7.jpg"  class="_2273kGdT_0"> <div class="_2CG0SquK_0"><div class="_304R4gla_0"><div><div class="_18Dng5rT_0"><span>诗坤</span> <!----></div> <div class="_1H1Z49Dr_0">2018-08-21</div></div> <div class="_2eMTs2JE_0"><div class="_2P4B1Hdm_0"><i class="iconfont"></i> <span class="">1</span></div> <!----> <!----></div></div> <div class="_3M6kV3zb_0">我记得有一次做业务，当时不知道什么原因，整体使用微服务，当时是个新业务，完全从0开始，没有任何用户基础，当时按照业务把服务拆成了7.8个微服务，但没有自动化，服务还是部署在一台机器上，服务之间也没有服务治理，服务之间的调用链很长，开发就4.5个人，定位问题花费时间长，典型的基础服务也跟不上。现在想想，当时团队不知道咋想的，觉得微服务比较新就上了，完全没有考虑到产生的问题。还好后来这块业务黄了。要不然估计坑更多。对于创业公司来说，刚开始的时候，其实一个服务就够了，真等用户上来了，业务有希望了，那时候再上其他架构模式也不迟，忌讳一开始就求新求全，说到底，对于大部分公司来说。技术是为业务服务的。</div> <div class="_2r3UB1GX_0"><span>展开</span><i class="iconfont"></i></div> <div class="_2xNIY4NG_0"><p class="_33BLbmw4_0">作者回复: 你们缺少一个真正的架构师</p></div></div></li></ul></div></div> <!----></div> <!----></div></div> </div><!----></body></html>